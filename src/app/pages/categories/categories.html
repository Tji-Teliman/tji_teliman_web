<div class="barre">
  <app-admin-header></app-admin-header>
</div>

<div class="page">

  <!-- LISTE LEFT -->
  <section class="card" style="flex:1;">

    <h2 class="title">Liste des Catégories</h2>

    <div class="table-wrap">
      <table class="table">

        <thead>
          <tr>
            <th>Nom</th>
            <th>Photo</th>
            <th>Missions</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let cat of categories()" class="row">

            <td>
              <div class="row-name">
                <div class="meta">
                  <div class="name">{{ cat.name }}</div>
                  <div class="desc">{{ cat.description }}</div>
                </div>
              </div>
            </td>

            <td>
              <img [src]="cat.photo" class="photo-thumb" />
            </td>

            <td>{{ cat.missions }}</td>

            <td>
              <button
                class="badge"
                [class.active]="cat.active"
                [class.inactive]="!cat.active"
                (click)="toggleCategory(cat)"
              >
                {{ cat.active ? 'Active' : 'Inactive' }}
              </button>
            </td>

            <td class="actions">
              <i class="fas fa-pencil-alt icon-action"
                 (click)="updateCategory(cat.id)">
              </i>

              <i class="fas fa-trash-alt icon-action red"
                 (click)="deleteCategory(cat.id)">
              </i>

              <i class="fas fa-toggle-{{ cat.active ? 'on' : 'off' }} icon-action"
                 (click)="toggleCategory(cat)">
              </i>
            </td>

          </tr>

          <!-- VIDE -->
          <tr *ngIf="categories().length === 0">
            <td colspan="5" class="empty">
              Aucune catégorie trouvée.
            </td>
          </tr>

        </tbody>

      </table>
    </div>

  </section>


  <!-- RIGHT -->
  <aside class="right">

    <!-- Formulaire dans le même style que l'ajout de compétence -->
    <div class="card form-card quick-add-section">
      <h3>Ajout Rapide</h3>

      <form (ngSubmit)="addCategory()">

        <div class="form-group">
          <label for="category-name">Nom de la catégorie</label>
          <input
            id="category-name"
            type="text"
            [(ngModel)]="newCategoryName"
            name="name"
            placeholder="Ex : Coiffure"
            required
          />
        </div>

        <div class="form-group">
          <label for="category-photo">Photo</label>
          <input
            id="category-photo"
            type="file"
            (change)="onFileSelected($event)"
            accept="image/*"
          />
        </div>

        <div class="form-group">
          <label for="category-desc">Description</label>
          <textarea
            id="category-desc"
            [(ngModel)]="newCategoryDescription"
            name="desc"
          ></textarea>
        </div>

        <div class="form-checkbox">
          <input
            type="checkbox"
            id="category-active"
            [(ngModel)]="newCategoryActive"
            name="active"
          />
          <label for="category-active">Catégorie active</label>
        </div>

        <button
          type="submit"
          class="add-skill-button"
          [disabled]="!newCategoryName.trim()"
        >
          <i class="fas fa-plus"></i>
          Ajouter la catégorie
        </button>

      </form>
    </div>

  </aside>
  <app-modal     #deleteModal
    type="confirmation"
    message="Voulez-vous vraiment supprimer cette catégorie ?"
    confirmText="Confirmer"
    cancelText="Annuler"
    (confirmed)="confirmDeletion()"
    (dismissed)="categoryToDeleteId = null"   >
</app-modal>
<app-modal     #successModal
type="success"
message="Catégorie supprimée avec succès"
[width]="350" ></app-modal>
</div>
