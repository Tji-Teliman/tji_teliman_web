<div class="barre">
  <app-admin-header></app-admin-header>
</div>

<div class="page">

  <!-- LISTE LEFT -->
  <section class="card" style="flex:1;">

    <h2 class="title">Liste des Catégories</h2>

    <div class="table-wrap">
      <table class="table">

        <thead>
          <tr>
            <th>Nom</th>
            <th>Photo</th>
            <th>Missions</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let cat of categories()" class="row">

            <td>
              <div class="row-name">
                <div class="meta">
                  <div class="name">{{ cat.name }}</div>
                  <div class="desc">{{ cat.description }}</div>
                </div>
              </div>
            </td>

            <td>
              <img [src]="'images/' + cat.photo" class="photo-thumb" />
            </td>

            <td>{{ cat.missions }}</td>

            <td>
              <button
                class="badge"
                [class.active]="cat.active"
                [class.inactive]="!cat.active"
                (click)="toggleCategory(cat)"
              >
                {{ cat.active ? 'Active' : 'Inactive' }}
              </button>
            </td>

            <td class="actions">
              <i class="fas fa-pencil-alt icon-action"
                 (click)="updateCategory(cat.id)">
              </i>

              <i class="fas fa-trash-alt icon-action red"
                 (click)="deleteCategory(cat.id)">
              </i>

              <i class="fas fa-toggle-{{ cat.active ? 'on' : 'off' }} icon-action"
                 (click)="toggleCategory(cat)">
              </i>
            </td>

          </tr>

          <!-- VIDE -->
          <tr *ngIf="categories().length === 0">
            <td colspan="5" class="empty">
              Aucune catégorie trouvée.
            </td>
          </tr>

        </tbody>

      </table>
    </div>

  </section>


  <!-- RIGHT -->
  <aside class="right">

    <div class="card stat-card">
      <div class="stat-title">Total Catégories</div>
      <div class="stat-number">{{ totalCategories }}</div>
      <div class="stat-sub">+ {{ newThisMonth }} ce mois-ci</div>
    </div>

    <div class="card form-card">
      <h3 class="form-title">Ajout Rapide</h3>

      <form (ngSubmit)="addCategory()" class="form">

        <label class="label">Nom de la catégorie</label>
        <input type="text" [(ngModel)]="newCategoryName" name="name"
               class="input" placeholder="Ex : Coiffure" required />

        <label class="label" style="margin-top:12px;">Photo</label>
        <input type="file" (change)="onFileSelected($event)"
               accept="image/*" />

        <label class="label" style="margin-top:12px;">Description</label>
        <textarea [(ngModel)]="newCategoryDescription" name="desc"
                  class="textarea"></textarea>

        <div class="checkbox-row">
          <input type="checkbox" [(ngModel)]="newCategoryActive" name="active">
          <label>Catégorie active</label>
        </div>

        <button type="submit" class="btn-add"
                [disabled]="!newCategoryName.trim()">
          + Ajouter la catégorie
        </button>

      </form>
    </div>

  </aside>
  <app-modal     #deleteModal
    type="confirmation"
    message="Voulez-vous vraiment supprimer cette catégorie ?"
    confirmText="Confirmer"
    cancelText="Annuler"
    (confirmed)="confirmDeletion()"
    (dismissed)="categoryToDeleteId = null"   >
</app-modal>
<app-modal     #successModal
type="success"
message="Catégorie supprimée avec succès"
[width]="350" ></app-modal>
</div>
